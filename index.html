<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Trainer – Mukammal yakuniy versiya</title>
    <style>
        *{box-sizing:border-box;}
        body{
            margin:0;height:100vh;background:#000;color:#0f0;
            font-family:'Courier New',monospace;
            display:flex;flex-direction:column;overflow:hidden;
        }

        /* Yuqori panel – info + statistika */
        .top-bar{
            width:100%;padding:12px 15px;
            display:flex;justify-content:space-between;align-items:center;
            flex-shrink:0;
        }
        #info{
            font-size:clamp(16px,4.5vw,28px);
            background:#111;padding:10px 18px;
            border:2px solid #0f0;border-radius:12px;color:#0a0;
        }
        #stats{
            background:#111;border:3px solid #0f0;border-radius:16px;
            padding:12px 30px;font-size:clamp(22px,6vw,36px);font-weight:bold;
            min-width:280px;text-align:center;
            box-shadow:0 0 35px #0f0;
        }
        #stats span{margin:0 20px;}

        /* Asosiy qism */
        .main{
            flex:1;display:flex;flex-direction:column;
            justify-content:center;align-items:center;
            padding:20px 10px;
        }
        #targetWord{
            font-size:clamp(70px,14vw,140px);
            letter-spacing:0.1em;margin-bottom:40px;
            text-shadow:0 0 50px #0f0;font-weight:bold;
        }
        #currentLetter{
            font-size:clamp(42px,10vw,110px);
            margin:20px 0;min-height:120px;color:#0ff;
        }
        #guessLine{
            font-size:clamp(60px,12vw,130px);
            letter-spacing:0.12em;margin:40px 0;
            min-height:150px;font-weight:bold;
        }
        #morseButton{
            width:clamp(250px,78vw,420px);
            height:clamp(250px,78vw,420px);
            border-radius:50%;background:#111;
            border:clamp(15px,5vw,25px) solid #0f0;
            box-shadow:0 0 100px #0f0;cursor:pointer;
            user-select:none;font-size:clamp(36px,10vw,60px);font-weight:bold;
            display:flex;align-items:center;justify-content:center;
            transition:0.1s;color:#0f0;
        }
        #morseButton.pressed{
            background:#0f0;color:#000;
            box-shadow:0 0 250px #0f0;transform:scale(0.92);
        }
        .wrong{animation:shake 0.6s;background:#600;}
        @keyframes shake{
            0%,100%{transform:translateX(0)}
            25%{transform:translateX(-40px)}
            75%{transform:translateX(40px)}
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <div id="info">
            Qisqa → .<br>0.5s → —
        </div>
        <div id="stats">
            To'g'ri: <span id="correctCount">0</span> | Xato: <span id="errorCount">0</span>
        </div>
    </div>

    <div class="main">
        <div id="targetWord">HELLO</div>
        <div id="currentLetter">H → ....</div>
        <div id="guessLine">_ _ _ _ _</div>
        <div id="morseButton">BOSING</div>
    </div>

    <script>
        const words = ["HELLO","WORLD","MORSE","CODE","RADIO","LIGHT","STAR","LOVE","PEACE","YES","NO","SOS","YOU","FRIEND","HOME","FIRE","WATER","BOOK","SKY","MOON","TEST","GOOD","NIGHT","WAVE","OCEAN","SIGNAL","BEACON","TREE","SUN","PARIS","LONDON","TOKYO"];

        const letterToMorse = {
            'A':'.-', 'B':'-...', 'C':'-.-.', 'D':'-..', 'E':'.', 'F':'..-.', 'G':'--.', 'H':'....',
            'I':'..', 'J':'.---', 'K':'-.-', 'L':'.-..', 'M':'--', 'N':'-.', 'O':'---', 'P':'.--.',
            'Q':'--.-', 'R':'.-.', 'S':'...', 'T':'-', 'U':'..-', 'V':'...-', 'W':'.--', 'X':'-..-',
            'Y':'-.--', 'Z':'--..'
        };

        let currentWord = "", currentIndex = 0, currentInput = "", guessed = [];
        let correctWords = 0, errorAttempts = 0;

        const targetEl = document.getElementById("targetWord");
        const currentLetterEl = document.getElementById("currentLetter");
        const guessEl = document.getElementById("guessLine");
        const buttonEl = document.getElementById("morseButton");
        const correctEl = document.getElementById("correctCount");
        const errorEl = document.getElementById("errorCount");

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(dur, freq = 800){
            const o=audioCtx.createOscillator(), g=audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.value=freq; o.type="sine"; g.gain.value=0.5;
            o.start(); o.stop(audioCtx.currentTime + dur/1000);
        }

        function updateStats(){
            correctEl.textContent = correctWords;
            errorEl.textContent = errorAttempts;
        }

        function newWord(){
            if(words.length===0){
                targetEl.textContent="TUGADI!";
                currentLetterEl.textContent=`Jami to'g'ri: ${correctWords}`;
                guessEl.textContent="Zo'r ish!";
                buttonEl.style.display="none";
                return;
            }
            const i=Math.floor(Math.random()*words.length);
            currentWord=words.splice(i,1)[0];
            currentIndex=0; guessed=[]; currentInput="";
            targetEl.textContent=currentWord;
            updateDisplay();
        }

        function updateDisplay(){
            const l=currentWord[currentIndex];
            currentLetterEl.textContent = `${l} → ${letterToMorse[l]}`;
            currentLetterEl.style.color="#0ff";

            let line="";
            for(let i=0;i<currentWord.length;i++) line += (guessed[i]||"_") + " ";
            guessEl.textContent=line.trim();
        }

        function wrong(){
            errorAttempts++;
            updateStats();
            document.body.classList.add("wrong");
            playTone(500,300);
            currentLetterEl.style.color="#f00";
            currentLetterEl.textContent += "  XATO!";
            setTimeout(()=>{
                document.body.classList.remove("wrong");
                currentInput="";
                updateDisplay();
            },1000);
        }

        function correct(){
            guessed.push(currentWord[currentIndex]);
            playTone(200,1200);
            currentIndex++;
            currentInput="";
            if(currentIndex===currentWord.length){
                correctWords++;
                updateStats();
                setTimeout(newWord,1200);
            }else{
                updateDisplay();
            }
        }

        let pressStart=0;
        const LONG_PRESS=500;

        buttonEl.addEventListener("mousedown",e=>{e.preventDefault();pressStart=Date.now();buttonEl.classList.add("pressed");});
        buttonEl.addEventListener("mouseup",e=>{
            e.preventDefault();
            if(!buttonEl.classList.contains("pressed")) return;
            const dur=Date.now()-pressStart;
            buttonEl.classList.remove("pressed");

            currentInput += dur < LONG_PRESS ? "." : "-";
            playTone(dur < LONG_PRESS ? 120 : 360, 900);

            const expected = letterToMorse[currentWord[currentIndex]];
            if(currentInput === expected){
                correct();
            }
            else if(!expected.startsWith(currentInput) && currentInput.length >= 2){
                wrong();
            }
        });

        buttonEl.addEventListener("touchstart",e=>{e.preventDefault();buttonEl.dispatchEvent(new Event("mousedown"));});
        buttonEl.addEventListener("touchend",e=>{e.preventDefault();buttonEl.dispatchEvent(new Event("mouseup"));});

        newWord();
        updateStats();
        document.body.addEventListener("click",()=>audioCtx.resume(),{once:true});
    </script>
</body>
</html>
